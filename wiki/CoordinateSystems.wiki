#summary Coordinate systems found in Parsley

= Introduction =
Parsley and it's third-party libraries need to operate on different coordinate frames. Therefore, coordination and mapping between those coordinate frames is crucial. The following components in Parsley manipulate coordinate frames
 * _Parsley.Core_ 
 * _Parsley.Draw3D_
 * _Emgu_
 * _OpenCV_
 * _System.Drawing_
 * _!OpenSceneGraph_
 
The following coordinate systems will apply to all components, unless otherwise noted.
Parsley uses [http://en.wikipedia.org/wiki/Right-handed_coordinate_system right-handed] coordinate systems. When expressed as matrix, _Parsley.Core_|_Emgu_|_OpenCV_ store basis vectors in columns. In the case of homogeneous coordinates, the translation is therefore found in the fourth column. _!OpenSceneGraph_ stores basis vectors in rows, which requires a matrix [http://en.wikipedia.org/wiki/Transpose transposition] to convert to matrices expressed in the components _Parsley.Core_|_Emgu_|_OpenCV_. This transposition is currently carried out implicitly by routines of _Parsley.Draw3D_.

= Image Coordinate System =
The image coordinate system is a two-dimensional coordinate system. The units are in pixels. The origin is in the top-left corner, positive x-axis points to the right and the positive y-axis points downward.

http://parsley.googlecode.com/svn/trunk/doc/frames/ImageCS.png

When accessing images in _System.Drawing_|_Emgu_ using the `[]` operator, the access pattern is `[row,column]` which corresponds to coordinates `[y,x]` in the image coordinate system.

= Camera Coordinate System = 
The camera coordinate system is a three-dimensional coordinate system. The units are millimeters. Its origin lies in the projection-center of the pinhole camera model. The x-axis and y-axis run parallel to the x-axis and y-axis of the [CoordinateSystems#Image_Coordinate_System image coordinate system]. The view direction corresponds to the positive z-axis. _!OpenSceneGraph_ uses the negative z-axis as view direction, which requires a rotation to fix.

http://parsley.googlecode.com/svn/trunk/doc/frames/CameraCS.png

The principal axis is a straight line through the projection center and orthogonal to the image plane. The principal point is the intersection of the principal axis and the image plane. The units of the principal point are pixels. The focal length is the distance of the center of projection to the principal point measured along the principal axis. In _OpenCV_ the units are pixels and given for the x-direction and y-direction separately since pixels need not to be square. Focal length and principal points are stored in the [http://opencv.willowgarage.com/documentation/camera_calibration_and_3d_reconstruction.html intrinsic calibration matrix].

= Chessboard Coordinate System = 
The chessboard coordinate system is a three-dimensional coordinate system. The units are in millimeters.
When viewed from the top, so that the top-left field is black, then the x-axis points to the right, the y-axis points downwards and the z-axis points into the pattern.  The origin lies in the plane defined by the chessboard pattern and is fixed to the first inner corner measured along the described axes.

http://parsley.googlecode.com/svn/trunk/doc/frames/ChessboardCS.png

The chessboard coordinate system can be found by estimating a transformation that aligns the corner points expressed in the chessboard coordinate system with corner points detected in the image coordinate system. This calibration is called extrinsic calibration.

= Circle Pattern Coordinate System =
Another pattern which can be used for intrinsic or extrinsic camera calibration is the circle pattern. Since the circles turn into ellipses, because of perspective distortion, when the pattern is viewed from different camera positions, a robust ellipse detection algorithm is needed in order to achieve proper pattern detection.
The correct position of the coordinate systems' origin can be found by sorting the ellipses in an rotation-invariant, unique order. Based on the white markers - located in the center of the ellipses - the number of white-black transitions, which are registered when following an ellipse shaped path within the ellipse, can be used to rank the detected ellipses in descending order.

http://parsley.googlecode.com/svn/trunk/doc/frames/CircleCS.png

Finally, the coordinate system can be fit into the center of the ellipse, which contains the marker with the highest number of white-black transitions. With reference to the given pattern example, the coordinate system is located in the center point of the ellipse, next to the top-left corner of the pattern. The orientation of the coordinate axes corresponds to the orientation of the chessboard coordinate system.